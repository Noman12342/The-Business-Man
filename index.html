import React, { useState, useEffect, useMemo } from 'react';

// --- Icon Components ---
const TrendingUp = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></svg>
);
const Building = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="2" width="16" height="20" rx="2" ry="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M12 6h.01" /><path d="M12 10h.01" /><path d="M12 14h.01" /><path d="M16 10h.01" /><path d="M8 10h.01" /><path d="M8 14h.01" /><path d="M16 14h.01" /></svg>
);
const PieChart = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21.21 15.89A10 10 0 1 1 8.11 3.99" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></svg>
);
const Grid = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></svg>
);
const User = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>
);
const ChevronLeft = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>
);
const ChevronRight = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>
);
const LocationPin = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;

// --- Logo Components ---
const AppleLogo = () => <svg className="w-6 h-6 text-gray-800" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5,15.76C16.5,15.76,16.5,15.76,16.5,15.76c-0.28,0.88-0.75,1.7-1.38,2.44c-0.66,0.78-1.48,1.38-2.63,1.38 c-0.96,0-1.88-0.5-2.69-1.34c-0.8-0.84-1.4-2.02-1.4-3.3c0-1.5,0.6-2.69,1.4-3.53c0.77-0.81,1.7-1.28,2.69-1.28 c0.5,0,1.23,0.19,1.88,0.56C15.1,13.43,15.36,13.2,16.5,13.2c1.23,0,2.39-0.85,2.4-0.88c-1.23-1.62-3.13-1.84-3.8-1.88 c-0.83-0.06-1.6,0.38-2.25,0.38c-0.65,0-1.31-0.38-2.19-0.38c-1.44,0-2.69,0.75-3.44,1.94c-0.96,1.5-1.12,3.75,0.31,5.44 c0.72,0.88,1.66,1.44,2.69,1.44c0.88,0,1.63-0.44,2.38-1.25c0.75-0.81,1.25-1.94,1.31-2.06C16.5,15.76,16.5,15.76,16.5,15.76z M15.19,8.56c0.06-0.94-0.5-1.81-1.25-2.31c-0.69-0.44-1.5-0.5-2.12-0.5c-1.38,0-2.69,0.88-3.38,2.19c-0.69,1.31,0,3,1.31,3.62 c0.69,0.31,1.5,0.19,2.19,0.19c0.69,0,1.5-0.25,2.12-0.75C14.88,10.5,15.13,9.5,15.19,8.56z"/></svg>;
const MicrosoftLogo = () => <div className="grid grid-cols-2 w-6 h-6 gap-px"><div className="bg-[#f25022]"></div><div className="bg-[#7fba00]"></div><div className="bg-[#00a4ef]"></div><div className="bg-[#ffb900]"></div></div>;
const GoogleLogo = () => <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" alt="Google" className="h-6" onError={(e) => e.target.style.display='none'}/>;
const AmazonLogo = () => <svg className="w-7 h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M19.22,14.34a5.18,5.18,0,0,1-3.3,4.41,5.09,5.09,0,0,1-5.46-1.42,1,1,0,0,1,1.41-1.41,3.09,3.09,0,0,0,3.13.82,3.18,3.18,0,0,0,2.1-3.23c0-.13,0-.26,0-.39H12a1,1,0,0,1,0-2h7.45a5.1,5.1,0,0,1,.23,1.22A5.17,5.17,0,0,1,19.22,14.34Z"/><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm6.91,6.26L17.5,9.67a1,1,0,0,1-1.41,0L13.22,6.8a5.2,5.2,0,0,0-6.42,5.5,5.15,5.15,0,0,0,4.2,4.82,1,1,0,0,1,.8-1.83A3.15,3.15,0,0,1,8.92,12a3.2,3.2,0,0,1,3.8-3.11L11.3,10.3a1,1,0,0,1,0,1.41L9.89,13.12a1,1,0,0,1-1.41,0L4.22,8.86A8,8,0,0,1,17.47,4.85,1,1,0,0,1,18.91,6.26Z"/></svg>;
const NvidiaLogo = () => <svg className="w-8 h-8 text-green-600" viewBox="0 0 24 24" fill="currentColor"><path d="M11.23 15.34a1.76 1.76 0 0 1-1.6 1.13 1.69 1.69 0 0 1-1.74-1.63v-5.4a1.86 1.86 0 0 1 .31-1 1.68 1.68 0 0 1 1.43-.61 1.76 1.76 0 0 1 1.6 1.13v6.4zm-1.6-9.87a1.69 1.69 0 0 0-1.74-1.63 1.86 1.86 0 0 0-.31 1v2.52l2.05-2.89zm6.65 1.54V4a1.68 1.68 0 0 0-1.43-.61 1.76 1.76 0 0 0-1.6 1.13l-6.28 8.81V17a1.86 1.86 0 0 0 .31 1 1.69 1.69 0 0 0 1.74 1.63 1.76 1.76 0 0 0 1.6-1.13l6.28-8.81V6.9a1.86 1.86 0 0 0-.31-1zm-6.28 8.81L7.95 9.42v2.52a1.76 1.76 0 0 0 1.6 1.13 1.68 1.68 0 0 0 1.43-.61l-1.35 1.9zM22 12c0 5.52-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2s10 4.48 10 10z"/></svg>;
const TeslaLogo = () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M16.58,4.6L15,4.22l-3,9.59L9,4.22L7.42,4.6L12,20L16.58,4.6M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10,10-4.48,10-10S17.52,2,12,2Z"/></svg>;
const MetaLogo = () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M22.05,12.05C22.05,6.51,17.54,2,12,2S1.95,6.51,1.95,12.05c0,4.41,2.87,8.17,6.84,9.49V13.84H6.48v-3.56h2.3V7.61c0-2.27,1.35-3.52,3.41-3.52c0.97,0,1.94,0.18,1.94,0.18v3.06h-1.57c-1.1,0-1.43,0.69-1.43,1.37v2.64h3.41l-0.53,3.56h-2.88v7.69C19.18,20.22,22.05,16.46,22.05,12.05Z"/></svg>;
const VisaLogo = () => <svg className="w-8 h-8" fill="none" viewBox="0 0 40 26"><path fill="#142688" fillRule="evenodd" d="M30.41 25.12L35.2 0H40L32.8 25.12h-2.4zm-19.2-25.12L5.6 18.04l-.8-3.92L9.53 0h5.2zm-5.28 25.12H0L7.2.01h5.2L7.13 25.12zM36.8 6.24c.4.4.6.93.6 1.53 0 .6-.2 1.2-.6 1.53l-6.32 6.4v9.42h-5.2V17.2L20.8 8.05c-.8-.8-1.2-1.8-1.2-2.88 0-2.13 1.73-3.85 3.85-3.85h4.72c1.47 0 2.73.8 3.48 2 .75-1.2 2-2 3.47-2h.02z" clipRule="evenodd"/></svg>;
const NetflixLogo = () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="#e50914"><path d="M8.496226,18.8163265 L8.496226,5.03265306 L11.2163265,5.03265306 L11.2163265,18.4326531 C12.8341837,17.5688776 14.0535714,16.5178571 15.0862245,15.1428571 L15.0862245,5.03265306 L17.8061224,5.03265306 L17.8061224,18.9673469 C17.8061224,19.3331633 17.5188776,19.5204082 17.077551,19.5204082 C16.6362245,19.5204082 16.2755102,19.3112245 15.8673469,19.0489796 L11.4591837,13.7959184 C10.9923469,14.6653061 10.377551,15.4260204 9.71173469,16.1867347 L8.6122449,17.7081633 C8.21938776,18.3035714 7.82142857,18.8928571 7.42346939,19.4765306 C7.0255102,19.4642857 6.62755102,19.4520408 6.22959184,19.4397959 C6.25510204,19.2678571 6.28061224,19.0959184 6.30612245,18.9239796 C6.94642857,17.9158163 7.64540816,16.9744898 8.496226,15.4204082 L8.496226,18.8163265 Z"/></svg>;
const McDonaldsLogo = () => <svg className="w-7 h-7" viewBox="0 0 24 24" fill="#ffc72c"><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm-3.17,15.42A7.54,7.54,0,0,1,5,11.56,7.49,7.49,0,0,1,8.83,4.58,1,1,0,0,1,10,5.75,5.65,5.65,0,0,0,12,6.56,5.65,5.65,0,0,0,14,5.75a1,1,0,0,1,1.17-1.17A7.49,7.49,0,0,1,19,11.56a7.54,7.54,0,0,1-3.83,5.86A1,1,0,0,1,14,16.25a5.45,5.45,0,0,0-4,0A1,1,0,0,1,8.83,17.42Z"/></svg>;
const BitcoinLogo = () => <svg className="w-6 h-6 text-yellow-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm3.23,12.33a2.79,2.79,0,0,1-1.89.7H12.5v2.5H11.25V15H10.5a.75.75,0,0,1,0-1.5h.75V12.75H10.5a.75.75,0,0,1,0-1.5h.75V10.5H10.5a.75.75,0,0,1,0-1.5h.75V6.5h3.14a2.79,2.79,0,0,1,2.21,1.1,2.06,2.06,0,0,1,.12,2.37A2.08,2.08,0,0,1,15.23,12.33Zm-1.89-3.33H12.5v2.5h.84a1.48,1.48,0,0,0,1.42-1.25A1.49,1.49,0,0,0,13.34,9Z"/></svg>;
const EthereumLogo = () => <svg className="w-6 h-6 text-gray-800" viewBox="0 0 24 24" fill="currentColor"><path d="M12,1.75l-6.15,10.65,6.15,3.5,6.15-3.5L12,1.75Zm0,18.5,6.15-3.5-6.15,7V16.75Z M12,1.75,5.85,12.4,12,15.9,18.15,12.4,12,1.75Z"/></svg>;
const GenericLogo = ({ letter, color }) => <div className={`text-xl font-bold ${color || 'text-gray-700'}`}>{letter}</div>;


// --- Data ---
const initialStockData = [
    { id: 1, name: 'Apple', logo: <AppleLogo />, price: 170.87 }, { id: 2, name: 'Microsoft', logo: <MicrosoftLogo />, price: 334.06 },
    { id: 3, name: 'Google', logo: <GoogleLogo />, price: 141.41 }, { id: 4, name: 'Amazon', logo: <AmazonLogo />, price: 131.57 },
    { id: 5, name: 'NVIDIA', logo: <NvidiaLogo />, price: 469.21 }, { id: 6, name: 'Tesla', logo: <TeslaLogo />, price: 265.85 },
    { id: 7, name: 'Meta Platforms', logo: <MetaLogo />, price: 325.48 }, { id: 8, name: 'Berkshire Hathaway', logo: <GenericLogo letter="B" />, price: 542.90 },
    { id: 9, name: 'Eli Lilly', logo: <GenericLogo letter="L" />, price: 580.10 }, { id: 10, name: 'Visa', logo: <VisaLogo />, price: 240.75 },
    { id: 11, name: 'Johnson & Johnson', logo: <GenericLogo letter="J" />, price: 165.30 }, { id: 12, name: 'Walmart', logo: <GenericLogo letter="W" />, price: 160.15 },
    { id: 13, name: 'JPMorgan Chase', logo: <GenericLogo letter="J" />, price: 150.80 }, { id: 14, name: 'Exxon Mobil', logo: <GenericLogo letter="X" />, price: 110.25 },
    { id: 15, name: 'UnitedHealth', logo: <GenericLogo letter="U" />, price: 520.60 }, { id: 16, name: 'Mastercard', logo: <GenericLogo letter="M" />, price: 390.90 },
    { id: 17, name: 'Procter & Gamble', logo: <GenericLogo letter="P" />, price: 155.45 }, { id: 18, name: 'Oracle', logo: <GenericLogo letter="O" />, price: 120.35 },
    { id: 19, name: 'Home Depot', logo: <GenericLogo letter="H" />, price: 330.20 }, { id: 20, name: 'Chevron', logo: <GenericLogo letter="C" />, price: 165.70 },
    { id: 21, name: 'Merck & Co.', logo: <GenericLogo letter="M" />, price: 115.90 }, { id: 22, name: 'Adobe', logo: <GenericLogo letter="A" />, price: 550.40 },
    { id: 23, name: 'Coca-Cola', logo: <GenericLogo letter="C" />, price: 60.25 }, { id: 24, name: 'Bank of America', logo: <GenericLogo letter="B" />, price: 30.10 },
    { id: 25, name: 'Pepsico', logo: <GenericLogo letter="P" />, price: 180.50 }, { id: 26, name: 'Salesforce', logo: <GenericLogo letter="S" />, price: 225.80 },
    { id: 27, name: 'Cisco', logo: <GenericLogo letter="C" />, price: 55.40 }, { id: 28, name: 'Intel', logo: <GenericLogo letter="I" />, price: 35.60 },
    { id: 29, name: 'Netflix', logo: <NetflixLogo />, price: 440.30 }, { id: 30, name: 'AMD', logo: <GenericLogo letter="A" />, price: 110.10 },
    { id: 31, name: 'Disney', logo: <GenericLogo letter="D" />, price: 85.90 }, { id: 32, name: 'Pfizer', logo: <GenericLogo letter="P" />, price: 36.20 },
    { id: 33, name: 'AT&T', logo: <GenericLogo letter="T" />, price: 14.80 }, { id: 34, name: 'Verizon', logo: <GenericLogo letter="V" />, price: 34.50 },
    { id: 35, name: 'Nike', logo: <GenericLogo letter="N" />, price: 105.70 }, { id: 36, name: 'McDonalds', logo: <McDonaldsLogo />, price: 290.40 },
    { id: 37, name: 'IBM', logo: <GenericLogo letter="I" />, price: 145.20 }, { id: 38, name: 'Starbucks', logo: <GenericLogo letter="S" />, price: 100.80 },
    { id: 39, name: 'Ford', logo: <GenericLogo letter="F" />, price: 12.50 }, { id: 40, name: 'General Motors', logo: <GenericLogo letter="G" />, price: 38.60 },
    { id: 41, name: 'Sony', logo: <GenericLogo letter="S" />, price: 95.30 }, { id: 42, name: 'Toyota', logo: <GenericLogo letter="T" />, price: 180.10 },
    { id: 43, name: 'Samsung', logo: <GenericLogo letter="S" />, price: 60.50 }, { id: 44, name: 'SAP', logo: <GenericLogo letter="S" />, price: 140.70 },
    { id: 45, name: 'Costco', logo: <GenericLogo letter="C" />, price: 550.90 }, { id: 46, 'name': 'PayPal', 'logo': <GenericLogo letter="P" />, 'price': 63.80 },
    { id: 47, 'name': 'Intuit', 'logo': <GenericLogo letter="I" />, 'price': 475.60 }, { id: 48, 'name': 'Amgen', 'logo': <GenericLogo letter="A" />, 'price': 230.40 },
    { id: 49, 'name': 'Qualcomm', 'logo': <GenericLogo letter="Q" />, 'price': 125.10 }, { id: 50, 'name': 'Boeing', 'logo': <GenericLogo letter="B" />, 'price': 215.80 }
];

const initialCryptoData = [
    { id: 51, name: 'Bitcoin', symbol: 'BTC', logo: <BitcoinLogo />, price: 29850.55 }, { id: 52, name: 'Ethereum', symbol: 'ETH', logo: <EthereumLogo />, price: 1850.25 },
    { id: 53, name: 'Tether', symbol: 'USDT', logo: <GenericLogo letter="T" color="text-green-500"/>, price: 1.00 }, { id: 54, name: 'Ripple', symbol: 'XRP', logo: <GenericLogo letter="X" color="text-blue-500"/>, price: 0.71 },
    { id: 55, name: 'Cardano', symbol: 'ADA', logo: <GenericLogo letter="A" color="text-blue-400"/>, price: 0.30 }, { id: 56, name: 'Dogecoin', symbol: 'DOGE', logo: <GenericLogo letter="D" color="text-yellow-400"/>, price: 0.07 },
    { id: 57, name: 'Solana', symbol: 'SOL', logo: <GenericLogo letter="S" color="text-purple-500"/>, price: 24.50 }, { id: 58, name: 'Litecoin', symbol: 'LTC', logo: <GenericLogo letter="L" color="text-gray-400"/>, price: 92.80 },
    { id: 59, name: 'Polkadot', symbol: 'DOT', logo: <GenericLogo letter="P" color="text-pink-500"/>, price: 5.20 }, { id: 60, name: 'Polygon', symbol: 'MATIC', logo: <GenericLogo letter="M" color="text-purple-400"/>, price: 0.75 },
    { id: 61, name: 'Binance Coin', symbol: 'BNB', logo: <GenericLogo letter="B" color="text-yellow-600"/>, price: 240.10 }, { id: 62, name: 'USD Coin', symbol: 'USDC', logo: <GenericLogo letter="U" color="text-blue-600"/>, price: 1.00 },
    { id: 63, name: 'Shiba Inu', symbol: 'SHIB', logo: <GenericLogo letter="S" color="text-orange-500"/>, price: 0.000008 }, { id: 64, name: 'TRON', symbol: 'TRX', logo: <GenericLogo letter="T" color="text-red-600"/>, price: 0.08 },
    { id: 65, name: 'Avalanche', symbol: 'AVAX', logo: <GenericLogo letter="A" color="text-red-500"/>, price: 13.55 }, { id: 66, name: 'Chainlink', symbol: 'LINK', logo: <GenericLogo letter="L" color="text-blue-700"/>, price: 6.45 },
    { id: 67, name: 'Uniswap', symbol: 'UNI', logo: <GenericLogo letter="U" color="text-pink-600"/>, price: 5.80 }, { id: 68, name: 'Monero', symbol: 'XMR', logo: <GenericLogo letter="M" color="text-orange-600"/>, price: 160.20 },
    { id: 69, name: 'Ethereum Classic', symbol: 'ETC', logo: <GenericLogo letter="E" color="text-green-600"/>, price: 18.90 }, { id: 70, name: 'Stellar', symbol: 'XLM', logo: <GenericLogo letter="S" color="text-gray-500"/>, price: 0.15 },
    { id: 71, name: 'Bitcoin Cash', symbol: 'BCH', logo: <GenericLogo letter="B" color="text-green-500"/>, price: 245.50 }, { id: 72, name: 'Cosmos', symbol: 'ATOM', logo: <GenericLogo letter="A" color="text-gray-700"/>, price: 9.30 },
    { id: 73, name: 'Algorand', symbol: 'ALGO', logo: <GenericLogo letter="A" color="text-teal-500"/>, price: 0.11 }, { id: 74, name: 'VeChain', symbol: 'VET', logo: <GenericLogo letter="V" color="text-blue-300"/>, price: 0.018 },
    { id: 75, name: 'Filecoin', symbol: 'FIL', logo: <GenericLogo letter="F" color="text-teal-400"/>, price: 4.10 }, { id: 76, name: 'Internet Computer', symbol: 'ICP', logo: <GenericLogo letter="I" color="text-indigo-500"/>, price: 4.25 },
    { id: 77, name: 'ApeCoin', symbol: 'APE', logo: <GenericLogo letter="A" color="text-blue-500"/>, price: 2.10 }, { id: 78, name: 'Hedera', symbol: 'HBAR', logo: <GenericLogo letter="H" />, price: 0.05 },
    { id: 79, name: 'EOS', symbol: 'EOS', logo: <GenericLogo letter="E" />, price: 0.75 }, { id: 80, name: 'The Sandbox', symbol: 'SAND', logo: <GenericLogo letter="S" color="text-blue-400"/>, price: 0.42 },
    { id: 81, name: 'Decentraland', symbol: 'MANA', logo: <GenericLogo letter="M" color="text-orange-400"/>, price: 0.40 }, { id: 82, name: 'Tezos', symbol: 'XTZ', logo: <GenericLogo letter="T" color="text-blue-500"/>, price: 0.85 },
    { id: 83, name: 'Quant', symbol: 'QNT', logo: <GenericLogo letter="Q" />, price: 105.60 }, { id: 84, name: 'Fantom', symbol: 'FTM', logo: <GenericLogo letter="F" color="text-blue-600"/>, price: 0.25 },
    { id: 85, name: 'Aave', symbol: 'AAVE', logo: <GenericLogo letter="A" color="text-teal-300"/>, price: 65.70 }, { id: 86, name: 'Theta Network', symbol: 'THETA', logo: <GenericLogo letter="T" color="text-cyan-400"/>, price: 0.78 },
    { id: 87, name: 'Axie Infinity', symbol: 'AXS', logo: <GenericLogo letter="A" color="text-blue-400"/>, price: 6.15 }, { id: 88, name: 'BitTorrent', symbol: 'BTT', logo: <GenericLogo letter="B" color="text-purple-500"/>, price: 0.00000048 },
    { id: 89, name: 'Maker', symbol: 'MKR', logo: <GenericLogo letter="M" color="text-teal-500"/>, price: 1120.40 }, { id: 90, name: 'Zcash', symbol: 'ZEC', logo: <GenericLogo letter="Z" color="text-yellow-600"/>, price: 29.80 },
    { id: 91, name: 'IOTA', symbol: 'MIOTA', logo: <GenericLogo letter="I" />, price: 0.16 }, { id: 92, name: 'Neo', symbol: 'NEO', logo: <GenericLogo letter="N" color="text-green-500"/>, price: 8.90 },
    { id: 93, name: 'Flow', symbol: 'FLOW', logo: <GenericLogo letter="F" color="text-teal-300"/>, price: 0.55 }, { id: 94, name: 'Chiliz', symbol: 'CHZ', logo: <GenericLogo letter="C" color="text-red-600"/>, price: 0.06 },
    { id: 95, name: 'Enjin Coin', symbol: 'ENJ', logo: <GenericLogo letter="E" />, price: 0.30 }, { id: 96, name: 'Dash', symbol: 'DASH', logo: <GenericLogo letter="D" color="text-blue-600"/>, price: 29.50 },
    { id: 97, name: 'Synthetix', symbol: 'SNX', logo: <GenericLogo letter="S" color="text-blue-300"/>, price: 2.25 }, { id: 98, name: 'Basic Attention Token', symbol: 'BAT', logo: <GenericLogo letter="B" color="text-purple-600"/>, price: 0.20 },
    { id: 99, name: 'Compound', symbol: 'COMP', logo: <GenericLogo letter="C" color="text-green-400"/>, price: 42.10 }, { id: 100, name: 'Gala', symbol: 'GALA', logo: <GenericLogo letter="G" />, price: 0.025 }
];

const generateRealEstateData = () => {
    const data = [];
    const propertyTypes = ["Modern Villa", "Cozy Cottage", "Downtown Apartment", "Luxury Penthouse", "Suburban House", "Beachfront Bungalow", "Mountain Cabin", "Skyscraper Suite", "Historic Mansion", "Riverside Loft"];
    const locations = ["New York, USA", "London, UK", "Tokyo, Japan", "Sydney, Australia", "Dubai, UAE", "Singapore", "Hong Kong", "Los Angeles, USA", "Chicago, USA", "Toronto, Canada"];
    
    data.push({ id: 101, name: 'Eiffel Tower', location: 'Paris, France', price: 9500000, image: 'https://placehold.co/600x400/D1D5DB/374151?text=Eiffel+Tower' });
    data.push({ id: 102, name: 'Burj Khalifa', location: 'Dubai, UAE', price: 10000000, image: 'https://placehold.co/600x400/D1D5DB/374151?text=Burj+Khalifa' });
    data.push({ id: 103, name: 'Taj Mahal', location: 'Agra, India', price: 8000000, image: 'https://placehold.co/600x400/D1D5DB/374151?text=Taj+Mahal' });
    data.push({ id: 104, name: 'The Colosseum', location: 'Rome, Italy', price: 7500000, image: 'https://placehold.co/600x400/D1D5DB/374151?text=The+Colosseum' });
    data.push({ id: 105, name: 'Statue of Liberty', location: 'New York, USA', price: 9000000, image: 'https://placehold.co/600x400/D1D5DB/374151?text=Statue+of+Liberty' });

    for (let i = 106; i <= 200; i++) {
        const type = propertyTypes[Math.floor(Math.random() * propertyTypes.length)];
        const location = locations[Math.floor(Math.random() * locations.length)];
        const price = Math.floor(Math.random() * (9990000) + 10000);
        data.push({ id: i, name: type, location: location, price: price, image: `https://placehold.co/600x400/E5E7EB/4B5563?text=${type.replace(/\s/g,'+')}` });
    }
    return data.sort((a,b) => a.price - b.price);
};

const initialRealEstateData = generateRealEstateData();

// --- Graph Component ---
const StockGraph = ({ history, dir }) => {
    if (!history || history.length < 2) { return <div className="h-40 flex items-center justify-center text-gray-400">Not enough data for graph</div>; }
    const width = 300, height = 100, padding = 5;
    const maxVal = Math.max(...history), minVal = Math.min(...history);
    const range = maxVal - minVal === 0 ? 1 : maxVal - minVal;
    const points = history.map((val, i) => { const x = (i / (history.length - 1)) * (width - padding * 2) + padding; const y = height - ((val - minVal) / range) * (height - padding * 2) - padding; return `${x},${y}`; }).join(' ');
    const areaPoints = `${points} ${width - padding},${height - padding} ${padding},${height - padding}`;
    const lineColor = dir === 'up' ? '#22c55e' : '#ef4444';
    const gradientId = `gradient-${dir}`;
    return (
        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-auto" preserveAspectRatio="xMidYMid meet">
            <defs><linearGradient id={gradientId} x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style={{ stopColor: lineColor, stopOpacity: 0.3 }} /><stop offset="100%" style={{ stopColor: lineColor, stopOpacity: 0 }} /></linearGradient></defs>
            <polygon fill={`url(#${gradientId})`} points={areaPoints} />
            <polyline fill="none" stroke={lineColor} strokeWidth="2" points={points} />
        </svg>
    );
};

// --- Page Components ---
const MainDashboard = ({ onNavigate, gameStartDate, currentGameTime, balance }) => {
    const daysPassed = Math.floor((currentGameTime.getTime() - gameStartDate.getTime()) / (1000 * 60 * 60 * 24)) + 1;
    const timeString = currentGameTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

    return (
        <div className="p-4 text-white bg-slate-900 h-full">
          <header className="flex justify-between items-center mb-4">
            <h1 className="text-lg font-semibold">{`Day ${daysPassed}, ${timeString}`}</h1>
            <p className="text-sm">{currentGameTime.toLocaleDateString('en-US')}</p>
          </header>
          <div className="mb-6"> <button className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition"> Bank </button> </div>
          <div className="bg-white text-gray-800 rounded-xl p-6 mb-6 text-center shadow-lg">
            <p className="text-gray-500 text-sm">Total Balance</p>
            <p className="text-3xl sm:text-4xl font-bold tracking-tight">${balance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <div className="bg-white text-gray-800 rounded-xl p-4 text-center shadow-lg"><p className="text-lg font-semibold">Investing</p><p className="text-2xl font-bold">$0.00</p><p className="text-green-500 text-sm">+0.00%</p></div>
            <div className="bg-white text-gray-800 rounded-xl p-4 text-center shadow-lg"><p className="text-lg font-semibold">Business</p><p className="text-2xl font-bold">$0.00</p><p className="text-green-500 text-sm">+0.00%</p></div>
          </div>
        </div>
    );
};

// --- Investing Sub-Pages ---
const SharesView = ({ onNavigate }) => (
    <><div className="bg-blue-100 text-blue-900 rounded-xl p-4 cursor-pointer hover:bg-blue-200 transition"><div className="flex justify-between items-center"> <h2 className="font-bold">My stock portfolio</h2> <ChevronRight className="h-5 w-5" /> </div><p className="text-xs mt-2">Value of stock portfolio</p><p className="text-2xl font-bold">$0.00</p><p className="text-xs text-green-600">+ $0.00 (0.00%) for all time</p><p className="text-xs mt-2">Estimated yield per hour</p><p className="font-bold">$0.00</p></div><button onClick={() => onNavigate('stockMarket')} className="w-full bg-blue-500 text-white rounded-xl p-4 text-left cursor-pointer hover:bg-blue-600 transition"><div className="flex justify-between items-center"><div><h2 className="font-bold">Stock market</h2><p className="text-sm">View all available offers</p></div><ChevronRight className="h-5 w-5" /></div></button></>
);

const RealEstateView = ({ onNavigate, ownedProperties, totalValue, hourlyYield }) => (
    <><div className="bg-green-100 text-green-900 rounded-xl p-4 mb-4"><h2 className="font-bold">My real estate portfolio</h2><p className="text-xs mt-2">Value of real estate portfolio</p><p className="text-2xl font-bold">${totalValue.toLocaleString()}</p><p className="text-xs mt-2">Estimated yield per hour</p><p className="font-bold">${hourlyYield.toFixed(2)}</p></div><div className="space-y-2 mb-4">{ownedProperties.length > 0 ? ownedProperties.map(prop => (<div key={prop.id} onClick={() => onNavigate('ownedPropertyDetail', prop.id)} className="bg-white p-3 rounded-lg shadow cursor-pointer flex justify-between items-center"><div><p className="font-bold">{prop.name}</p><p className="text-sm text-gray-500">Level: {prop.level}</p></div><ChevronRight className="h-5 w-5 text-gray-400" /></div>)) : <p className="text-center text-gray-500">No properties owned.</p> }</div><button onClick={() => onNavigate('realEstateMarket')} className="w-full bg-green-500 text-white rounded-xl p-4 text-center cursor-pointer hover:bg-green-600 transition"><h2 className="font-bold">Buy Real Estate</h2></button></>
);

const CryptocurrencyView = ({ onNavigate }) => (
    <><div className="bg-yellow-100 text-yellow-900 rounded-xl p-4"><h2 className="font-bold">My crypto portfolio</h2><p className="text-xs mt-2">Value of crypto portfolio</p><p className="text-2xl font-bold">$0.00</p><p className="text-xs mt-2">Estimated yield per hour</p><p className="font-bold">$0.00</p></div><button onClick={() => onNavigate('cryptoMarket')} className="w-full bg-yellow-500 text-white rounded-xl p-4 text-center cursor-pointer hover:bg-yellow-600 transition"><h2 className="font-bold">Buy Cryptocurrency</h2></button></>
);

const InvestingPage = ({ onNavigate, ownedProperties, realEstateValue, realEstateYield }) => {
    const [activeSubTab, setActiveSubTab] = useState('Shares');
    return (
        <div className="bg-gray-100 text-gray-800 flex-grow flex flex-col"><header className="bg-white flex items-center p-4 border-b"><button onClick={() => onNavigate('earnings')} className="text-gray-600"><ChevronLeft className="h-6 w-6" /></button><h1 className="text-xl font-bold text-center flex-grow">Investing</h1><div className="w-6"></div></header><nav className="bg-white flex justify-around border-b px-4"><button onClick={() => setActiveSubTab('Shares')} className={`py-2 px-4 font-semibold text-sm ${activeSubTab === 'Shares' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-gray-400'}`}> Shares </button><button onClick={() => setActiveSubTab('Real Estate')} className={`py-2 px-4 font-semibold text-sm ${activeSubTab === 'Real Estate' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-gray-400'}`}> Real Estate </button><button onClick={() => setActiveSubTab('Cryptocurrency')} className={`py-2 px-4 font-semibold text-sm ${activeSubTab === 'Cryptocurrency' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-gray-400'}`}> Cryptocurrency </button></nav><div className="p-4 space-y-4 flex-grow">{activeSubTab === 'Shares' && <SharesView onNavigate={onNavigate} />}{activeSubTab === 'Real Estate' && <RealEstateView onNavigate={onNavigate} ownedProperties={ownedProperties} totalValue={realEstateValue} hourlyYield={realEstateYield} />}{activeSubTab === 'Cryptocurrency' && <CryptocurrencyView onNavigate={onNavigate} />}</div></div>
    );
};

const MarketListPage = ({ items, onSelectItem, onNavigateBack, title, type }) => (
    <div className="bg-white text-gray-800 flex-grow flex flex-col"><header className="bg-white flex items-center p-4 border-b sticky top-0 z-10"><button onClick={onNavigateBack} className="text-gray-600"><ChevronLeft className="h-6 w-6" /></button><h1 className="text-xl font-bold text-center flex-grow">{title}</h1><div className="w-6"></div></header><ul className="divide-y divide-gray-200 flex-grow overflow-y-auto">{items.map(item => (<li key={item.id} onClick={() => onSelectItem(item)} className="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50"><div className="flex items-center space-x-3"><div className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100">{item.logo}</div><div><p className="font-bold">{item.name}</p><p className="text-sm text-gray-500">{type === 'stock' ? 'Available' : item.symbol}</p></div></div><div className="text-right"><p className="font-bold">${item.price.toFixed(item.price > 1 ? 2 : 8)}</p><p className={`text-sm ${item.dir === 'up' ? 'text-green-500' : 'text-red-500'}`}>{item.dir === 'up' ? '+' : ''}{item.change.toFixed(2)} ({item.changePercent.toFixed(2)}%)</p></div></li>))}</ul></div>
);

const DetailPage = ({ item, onNavigateBack, type }) => {
    const [amount, setAmount] = useState(1);
    if(!item) return null;
    const totalPrice = (amount * item.price).toFixed(2);
    return(<div className="bg-gray-100 text-gray-800 flex-grow flex flex-col"><header className="bg-white flex items-center p-4 border-b sticky top-0 z-10"><button onClick={onNavigateBack} className="text-gray-600"><ChevronLeft className="h-6 w-6" /></button><h1 className="text-xl font-bold text-center flex-grow">{item.name}</h1><div className="w-6"></div></header><div className="p-4 flex-grow overflow-y-auto"><div className="text-center mb-4"><div className="w-16 h-16 mx-auto flex items-center justify-center rounded-full bg-gray-200 mb-2">{item.logo}</div><p className="text-3xl font-bold">${item.price.toFixed(item.price > 1 ? 2 : 8)}</p><p className={`text-lg ${item.dir === 'up' ? 'text-green-500' : 'text-red-500'}`}>{item.dir === 'up' ? '▲' : '▼'} {item.change.toFixed(2)} ({item.changePercent.toFixed(2)}%)</p></div><div className="my-4"><StockGraph history={item.history} dir={item.dir} /><p className="text-center text-xs text-gray-500 mt-1">Last 12 in-game hours</p></div><div className="mb-6"><label htmlFor="amount" className="block text-sm font-medium text-gray-700 mb-2">{type === 'stock' ? 'Number of shares:' : 'Amount:'}</label><input type="number" id="amount" min="1" value={amount} onChange={(e) => setAmount(Math.max(1, parseFloat(e.target.value) || 1))} className="w-full p-3 border border-gray-300 rounded-lg text-center text-xl" /></div><div className="text-center mb-6"><p className="text-gray-600">Total price</p><p className="text-2xl font-bold">${totalPrice}</p></div><div className="grid grid-cols-2 gap-4"><button className="w-full bg-red-500 text-white font-bold py-3 rounded-lg hover:bg-red-600 transition">Sell</button><button className="w-full bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600 transition">Buy</button></div></div></div>);
};

const RealEstateMarketPage = ({ onNavigateBack, properties, onBuy, ownedIds, balance }) => {
    const [sortOrder, setSortOrder] = useState('cheapFirst');
    const sortedProperties = useMemo(() => ([...properties].sort((a, b) => sortOrder === 'cheapFirst' ? a.price - b.price : b.price - a.price)), [properties, sortOrder]);
    const SortButton = ({ title, order }) => (<button onClick={() => setSortOrder(order)} className={`px-4 py-2 rounded-full text-sm font-semibold transition ${sortOrder === order ? 'bg-gray-800 text-white' : 'bg-gray-200 text-gray-700'}`}>{title}</button>);
    return (<div className="bg-gray-50 text-gray-800 flex-grow flex flex-col"><header className="bg-white flex items-center p-4 border-b sticky top-0 z-10 w-full"><button onClick={onNavigateBack} className="text-gray-600"><ChevronLeft className="h-6 w-6" /></button><div className="text-center flex-grow"><h1 className="text-xl font-bold">Real estate market</h1><p className="text-xs text-gray-500">Balance: ${balance.toLocaleString()}</p></div><div className="w-6"></div></header><div className="p-4 flex justify-center gap-2"><SortButton title="Expensive first" order="expensiveFirst" /><SortButton title="Cheap first" order="cheapFirst" /></div><ul className="flex-grow overflow-y-auto px-4 space-y-4 pb-4">{sortedProperties.map(prop => { const isOwned = ownedIds.includes(prop.id); const canAfford = balance >= prop.price; return (<li key={prop.id} className="bg-white rounded-xl shadow-md overflow-hidden"><img src={prop.image} alt={prop.name} className="w-full h-40 object-cover" onError={(e) => {e.target.onerror = null; e.target.src='https://placehold.co/600x400/D1D5DB/374151?text=Image+Not+Found'}} /><div className="p-4 flex justify-between items-center"><div><p className="text-lg font-bold">${prop.price.toLocaleString()}</p><div className="flex items-center text-gray-500"><LocationPin className="h-4 w-4 mr-1"/><p className="text-sm">{prop.name}, {prop.location}</p></div></div><button onClick={() => onBuy(prop)} disabled={isOwned || !canAfford} className={`font-bold py-2 px-6 rounded-lg transition ${isOwned ? 'bg-gray-400 text-white cursor-not-allowed' : canAfford ? 'bg-gray-800 text-white hover:bg-black' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>{isOwned ? 'Owned' : 'Buy'}</button></div></li>)})}</ul></div>);
};

const OwnedPropertyDetailPage = ({ property, onNavigateBack, onUpgrade, balance }) => {
    if (!property) return null;
    const getUpgradeCost = () => { if (property.level === 0) return property.purchasePrice * 0.25; if (property.level === 1) return property.currentValue * 0.30; if (property.level === 2) return property.currentValue * 0.30; return 0; };
    const upgradeCost = getUpgradeCost();
    const canAfford = balance >= upgradeCost;
    return (<div className="bg-gray-100 text-gray-800 flex-grow flex flex-col"><header className="bg-white flex items-center p-4 border-b sticky top-0 z-10"><button onClick={onNavigateBack} className="text-gray-600"><ChevronLeft className="h-6 w-6" /></button><h1 className="text-xl font-bold text-center flex-grow">{property.name}</h1><div className="w-6"></div></header><div className="p-4 flex-grow overflow-y-auto text-center"><img src={property.image} alt={property.name} className="w-full h-48 object-cover rounded-lg mb-4" onError={(e) => {e.target.onerror = null; e.target.src='https://placehold.co/600x400/D1D5DB/374151?text=Image+Not+Found'}} /><h2 className="text-2xl font-bold">{property.name}</h2><p className="text-gray-500 mb-4">{property.location}</p><div className="bg-white p-4 rounded-lg shadow-md mb-6"><p className="text-gray-600">Level</p><p className="text-4xl font-bold">{property.level}</p></div>{property.level < 3 ? (<div className="bg-white p-4 rounded-lg shadow-md"><p className="text-gray-600">Next Upgrade (Level {property.level + 1})</p><p className="text-xl font-bold mb-4">Cost: ${upgradeCost.toLocaleString()}</p><button onClick={() => onUpgrade(property.id, upgradeCost)} disabled={!canAfford} className={`w-full font-bold py-3 rounded-lg transition ${canAfford ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}>Upgrade</button></div>) : (<div className="bg-white p-4 rounded-lg shadow-md"><p className="text-xl font-bold text-green-600">Max Level Reached</p></div>)}</div></div>);
};

// --- Main App Component ---
function App() {
  const [activePage, setActivePage] = useState('earnings');
  
  const [balance, setBalance] = useState(100000);
  const [ownedProperties, setOwnedProperties] = useState([]);
  const [stocks, setStocks] = useState(initialStockData.map(s => ({...s, history: Array(12).fill(s.price), change: 0, changePercent: 0, dir: 'up'})));
  const [cryptos, setCryptos] = useState(initialCryptoData.map(c => ({...c, history: Array(12).fill(c.price), change: 0, changePercent: 0, dir: 'up'})));
  
  const [selectedItemId, setSelectedItemId] = useState(null);
  
  const [gameStartDate] = useState(new Date());
  const [realGameStartTime] = useState(Date.now());
  const [currentGameTime, setCurrentGameTime] = useState(gameStartDate);

  useEffect(() => {
    const timeInterval = setInterval(() => {
      const elapsedRealSeconds = (Date.now() - realGameStartTime) / 1000;
      const elapsedInGameMinutes = elapsedRealSeconds * 24;
      const newGameTime = new Date(gameStartDate.getTime() + elapsedInGameMinutes * 60 * 1000);
      setCurrentGameTime(newGameTime);
    }, 1000);

    const marketInterval = setInterval(() => {
        const updateItems = (items, initialData) => items.map(item => {
            const changeFactor = (Math.random() - 0.49) * 0.02;
            const newPrice = Math.max(0.00000001, item.price * (1 + changeFactor));
            const oldPrice = initialData.find(i => i.id === item.id)?.price || item.price;
            const newChange = newPrice - oldPrice;
            const newChangePercent = oldPrice ? (newChange / oldPrice) * 100 : 0;
            const newHistory = [...(item.history || Array(12).fill(newPrice)).slice(1), newPrice];
            return { ...item, price: newPrice, change: newChange, changePercent: newChangePercent, dir: newChange >= 0 ? 'up' : 'down', history: newHistory };
        });
        setStocks(current => updateItems(current, initialStockData));
        setCryptos(current => updateItems(current, initialCryptoData));
    }, 2500);
    
    // Real Estate Income (1 real minute = 1 game day)
    const incomeInterval = setInterval(() => {
        const totalMonthlyIncome = ownedProperties.reduce((sum, prop) => sum + prop.totalMonthlyIncome, 0);
        const incomePerMinute = totalMonthlyIncome / 30; // 30 days in a month
        setBalance(prev => prev + incomePerMinute);
    }, 60 * 1000); // every minute

    return () => { clearInterval(timeInterval); clearInterval(marketInterval); clearInterval(incomeInterval); };
  }, [gameStartDate, realGameStartTime, ownedProperties]);
  

  const navigate = (page, id = null) => {
      setActivePage(page);
      setSelectedItemId(id);
  };
  
  const selectItem = (item, type) => {
      setSelectedItemId(item.id);
      navigate(type === 'stock' ? 'stockDetail' : 'cryptoDetail');
  };

  const handleBuyProperty = (property) => {
    if (balance >= property.price) {
        setBalance(prev => prev - property.price);
        const newProperty = { ...property, purchasePrice: property.price, currentValue: property.price, level: 0, totalMonthlyIncome: property.price * 0.05 };
        setOwnedProperties(prev => [...prev, newProperty]);
    } else {
        alert("Not enough balance!");
    }
  };

  const handleUpgradeProperty = (propertyId, upgradeCost) => {
    const propertyToUpgrade = ownedProperties.find(p => p.id === propertyId);
    if (propertyToUpgrade && balance >= upgradeCost && propertyToUpgrade.level < 3) {
        setBalance(prev => prev - upgradeCost);
        setOwnedProperties(prev => prev.map(p => {
            if (p.id === propertyId) {
                return { ...p, level: p.level + 1, currentValue: p.currentValue + upgradeCost, totalMonthlyIncome: p.totalMonthlyIncome + (upgradeCost * 0.10) };
            }
            return p;
        }));
    }
  };
  
  const selectedItem = stocks.find(s => s.id === selectedItemId) || cryptos.find(c => c.id === selectedItemId) || ownedProperties.find(p => p.id === selectedItemId);
  
  const realEstateValue = ownedProperties.reduce((sum, prop) => sum + prop.currentValue, 0);
  const realEstateMonthlyYield = ownedProperties.reduce((sum, prop) => sum + prop.totalMonthlyIncome, 0);
  const realEstateHourlyYield = realEstateMonthlyYield / (30 * 24);

  const renderContent = () => {
      switch (activePage) {
          case 'investing': return <InvestingPage onNavigate={navigate} ownedProperties={ownedProperties} realEstateValue={realEstateValue} realEstateYield={realEstateHourlyYield} />;
          case 'stockMarket': return <MarketListPage items={stocks} onSelectItem={(item) => selectItem(item, 'stock')} onNavigateBack={() => navigate('investing')} title="Stock Market" type="stock" />;
          case 'stockDetail': return <DetailPage item={selectedItem} onNavigateBack={() => navigate('stockMarket')} type="stock" />;
          case 'cryptoMarket': return <MarketListPage items={cryptos} onSelectItem={(item) => selectItem(item, 'crypto')} onNavigateBack={() => navigate('investing')} title="Cryptocurrency Market" type="crypto" />;
          case 'cryptoDetail': return <DetailPage item={selectedItem} onNavigateBack={() => navigate('cryptoMarket')} type="crypto" />;
          case 'realEstateMarket': return <RealEstateMarketPage onNavigateBack={() => navigate('investing')} properties={initialRealEstateData} onBuy={handleBuyProperty} ownedIds={ownedProperties.map(p => p.id)} balance={balance} />;
          case 'ownedPropertyDetail': return <OwnedPropertyDetailPage property={selectedItem} onNavigateBack={() => navigate('investing')} onUpgrade={handleUpgradeProperty} balance={balance} />;
          default: 
            return <MainDashboard onNavigate={navigate} gameStartDate={gameStartDate} currentGameTime={currentGameTime} balance={balance}/>;
      }
  };
  
  const NavItem = ({ page, icon: Icon, label }) => {
    const isInvestingRelated = page === 'investing' && ['investing', 'stockMarket', 'stockDetail', 'cryptoMarket', 'cryptoDetail', 'realEstateMarket', 'ownedPropertyDetail'].includes(activePage);
    const isActive = activePage === page || isInvestingRelated;
    return (<button onClick={() => navigate(page)} className={`flex flex-col items-center justify-center text-center p-3 w-full transition-colors duration-200 ${isActive ? 'text-indigo-600' : 'text-gray-600 hover:text-indigo-600'}`}><Icon className="h-6 w-6 mb-1" /><span className="text-xs">{label}</span></button>);
  }

  return (
    <div className="bg-gray-800 font-sans leading-normal tracking-normal flex justify-center">
      <div className="w-full max-w-md bg-white flex flex-col min-h-screen">
        <main className="flex-grow flex flex-col">{renderContent()}</main>
        <footer className="bg-white sticky bottom-0 w-full border-t border-gray-200 z-20"><nav className="flex justify-around items-center"><NavItem page="investing" icon={TrendingUp} label="Investing" /><NavItem page="business" icon={Building} label="Business" /><NavItem page="earnings" icon={PieChart} label="Earnings" /><NavItem page="items" icon={Grid} label="Items" /><NavItem page="profile" icon={User} label="Profile" /></nav></footer>
      </div>
    </div>
  );
}

export default App;
